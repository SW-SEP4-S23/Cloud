// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//DATAPOINT

model Datapoint {
  timestamp DateTime
  type      DataType
  value     Float

  @@id([timestamp, type])
}

//THRESHOLDS

model Thresholds {
  dataType          DataType            @id
  minValue          Float?
  maxValue          Float?
  thresholdRequests ThresholdRequests[]
}

model ThresholdRequests {
  id          Int        @default(autoincrement())
  thresholds  Thresholds @relation(fields: [dataType], references: [dataType])
  dataType    DataType
  minValueReq Float
  maxValueReq Float
  requestDate DateTime
  ack         Ack?       @relation(fields: [ack_Id], references: [id])
  ack_Id      Int?

  @@id([id, dataType])
}

model Ack {
  id                Int                 @id @default(autoincrement())
  dateRecieved      DateTime?
  acked             Boolean
  thresholdRequests ThresholdRequests[]
}

//PLANTS

model PlantSpecies {
  name               String        @id
  OptimalCo2         Float?
  optimalHumidity    Float?
  optimalTemperature Float?
  PlantBatch         PlantBatch[]
  speciesLogs        SpeciesLogs[]
}

model PlantBatch {
  id           Int          @id @default(autoincrement())
  harvestDate  DateTime?
  plantingDate DateTime
  ps           PlantSpecies @relation(fields: [ps_Name], references: [name])
  ps_Name      String
  amount       Int
  Plant        Plant[]
  BatchLogs    BatchLogs[]
}

model Plant {
  id        Int         @id @default(autoincrement())
  pb        PlantBatch  @relation(fields: [pb_Id], references: [id])
  pb_Id     Int
  PlantLogs PlantLogs[]
}

model SpeciesLogs {
  id               Int          @id @default(autoincrement())
  timestamp        DateTime
  message          String
  plantSpecies     PlantSpecies @relation(fields: [plantSpeciesName], references: [name])
  plantSpeciesName String
}

model PlantLogs {
  id        Int      @id @default(autoincrement())
  timestamp DateTime
  message   String
  p         Plant    @relation(fields: [p_Id], references: [id])
  p_Id      Int
}

model BatchLogs {
  id        Int        @id @default(autoincrement())
  timestamp DateTime
  message   String
  pb        PlantBatch @relation(fields: [pb_Id], references: [id])
  pb_Id     Int
}

enum DataType {
  TEMPERATURE
  CO2
  HUMIDITY
}
